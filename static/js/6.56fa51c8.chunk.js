(window["webpackJsonpdragalia-lost"]=window["webpackJsonpdragalia-lost"]||[]).push([[6],{160:function(e,t,n){"use strict";n.r(t);var r=n(34),a=n(24),c=n(0),i=n.n(c),u=n(154),o=n(153),l=n(53),s=n(8),d=n(13),f=n(6),v=function(e,t){return e-t};function m(e,t){return e.reduce(function(e,n,r){var a=Math.abs(t-n);return null===e||a<e.distance||a===e.distance?{distance:a,index:r}:e},null).index}var b=function(e,t){if(void 0!==t.current&&e.changedTouches){for(var n=0;n<e.changedTouches.length;n+=1){var r=e.changedTouches[n];if(r.identifier===t.current)return r.clientX}return null}return e.clientX},h=function(e,t,n){return e<t?t:e>n?n:e},O=function(e,t,n){var r=(n-t)*e+t;return r=h(r,t,n),Math.round(r)},y=function(e,t,n,r){return(e-t)*r/(n-t)},E=function(e){var t=e.i,n=e.v,a=e.values,c=Object(r.a)(a);return c[t]=n,c};function j(e){var t=e.defaultValue,n=e.value,u=e.min,o=e.max,l=e.onChange,d=Object(c.useRef)(),f=Object(c.useState)({left:0,width:0}),j=Object(a.a)(f,2),p=j[0],w=j[1],g=Object(s.l)(function(){if(d.current){var e=d.current.getBoundingClientRect(),t=e.left,n=e.width;w({left:t,width:n-32})}});Object(c.useEffect)(function(){g()},[g]),Object(c.useEffect)(function(){return window.addEventListener("resize",g),function(){return window.removeEventListener("resize",g)}},[g]);var L=Object(c.useRef)(null!=n).current,k=i.a.useRef(),x=Object(c.useState)(t||[u,o]),C=Object(a.a)(x,2),P=C[0],D=C[1],N=L?n:P,S=Array.isArray(N),T=S?Object(r.a)(N).sort(v):[N];T=T.map(function(e){return h(e,u,o)});var M=i.a.useRef(),R=i.a.useCallback(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=p.left,r=p.width,a=(e-n)/r,c=O(a,u,o),i=t?M.current:m(T,c),l=E({i:i,v:c,values:T}).sort(v);return M.current=l.indexOf(c),l},[T,u,o,p]),F=Object(s.l)(function(e){var t=b(e,k);if(t){var n=R(t,!0);L||D(n),l&&l(n)}}),I=Object(s.l)(function(e){b(e,k)&&(k.current=void 0,document.body.removeEventListener("mousemove",F),document.body.removeEventListener("mouseup",I),document.body.removeEventListener("mouseenter",z),document.body.removeEventListener("touchmove",F),document.body.removeEventListener("touchend",I))}),z=Object(s.l)(function(e){0===e.buttons&&null!==e.relatedTarget&&I(e)}),A=Object(s.l)(function(e){e.preventDefault();var t=e.changedTouches[0];null!=t&&(k.current=t.identifier);var n=b(e,k),r=R(n);L||D(r),l&&l(r),document.body.addEventListener("touchmove",F),document.body.addEventListener("touchend",I)});Object(c.useEffect)(function(){var e=d.current;return e.addEventListener("touchstart",A),function(){e.removeEventListener("touchstart",A),document.body.removeEventListener("mousemove",F),document.body.removeEventListener("mouseup",I),document.body.removeEventListener("mouseenter",z),document.body.removeEventListener("touchmove",F),document.body.removeEventListener("touchend",I)}},[z,I,F,A]);var J=Object(s.l)(function(e){e.preventDefault();var t=b(e,k),n=R(t);L||D(n),l&&l(n),document.body.addEventListener("mousemove",F),document.body.addEventListener("mouseenter",z),document.body.addEventListener("mouseup",I)}),V=y(S?T[0]:u,u,o,p.width),X={left:V,width:y(T[T.length-1],u,o,p.width)-V};return i.a.createElement("div",{ref:d,className:"slider",onMouseDown:J},i.a.createElement("span",{className:"slider-rail"}),i.a.createElement("span",{className:"slider-track",style:X}),T.map(function(e,t){var n={left:y(e,u,o,p.width)};return i.a.createElement("div",{key:t,className:"slider-thumb",style:n,role:"slider",tabIndex:"0","aria-valuemax":o,"aria-valuemin":u,"aria-valuenow":e},e)}))}j.defaultProps={defaultValue:null,min:0};var p=i.a.memo(j);function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var g=function(e){var t=e.index,n=e.item,r=e.setFacility,a=i.a.useMemo(function(){return d.h[n.type]||30},[n.type]);return i.a.createElement("div",{className:"facility-item"},i.a.createElement(l.h,{field:"facility",image:n.id,onClick:function(){r(function(e){return e.filter(function(e,n){return n!==t})})}}),i.a.createElement(p,{max:a,value:n.value,onChange:function(e){r(function(n){return n.map(function(n,r){return r===t?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(n,!0).forEach(function(t){Object(f.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},n,{value:e}):n})})}}))};var L=i.a.memo(function(e){var t=e.columnIndex,n=e.rowIndex,r=e.style,a=e.data,c=a.dict,u=a.arr[2*n+t],o=c[u];return i.a.createElement(i.a.Fragment,null,o&&i.a.createElement("div",{style:r,className:"material-item"},i.a.createElement(l.h,{field:"material",image:u}),i.a.createElement("div",null,o)))}),k=["del","refresh","save","add"],x=function(e,t){switch(e){case"rupies":case"event":case"item":case"coin1":case"coin2":case"coin3":case"talonstone":return d.p[e];default:return d.p[e][t]}},C=function(e,t){for(var n=0,r=Object(a.a)(t,2),c=r[0],i=r[1],u=c;u<i;u+=1)n+=e[u];return n};var P=i.a.memo(function(){var e=Object(c.useState)(!1),t=Object(a.a)(e,2),n=t[0],f=t[1],v=Object(c.useState)(Object(s.e)("facility")||[]),m=Object(a.a)(v,2),b=m[0],h=m[1],O=Object(s.l)(function(e){switch(e.currentTarget.name){case"add":f(!0);break;case"del":h([]),Object(s.h)("facility");break;case"refresh":var t=Object(s.e)("facility");t&&h(t);break;case"save":Object(s.i)("facility",b)}}),y=Object(s.l)(function(e){var t=e.type,n=e.field,a="event"===t?"event":d.p[t][n],c=Object(s.d)(t);h(function(e){return[].concat(Object(r.a)(e),[{id:a,type:t,field:n,value:[0,c]}])})}),E=i.a.useMemo(function(){var e={};return b.forEach(function(t){t.value[0]!==t.value[1]&&Object.entries(d.q[t.type]).forEach(function(n){var r=Object(a.a)(n,2),c=r[0],i=r[1],u=C(i,t.value);if(0!==u){var o=x(c,t.field);e[o]=(e[o]||0)+u}})}),{dict:e,arr:Object.keys(e)}},[b]);return i.a.createElement("main",{id:"facility"},i.a.createElement("div",null,i.a.createElement(l.g,{btns:k,onClick:O}),i.a.createElement("div",null,b.map(function(e,t){return i.a.createElement(g,{key:t,index:t,item:e,setFacility:h})})),i.a.createElement(l.c,{open:n,setOpen:f,onCreate:y})),i.a.createElement("div",{ref:s.g.col3},i.a.createElement(o.a,null,function(e){var t=e.height,n=e.width;return i.a.createElement(u.a,{width:n,height:t,itemData:E,columnCount:2,columnWidth:n/2-8,rowCount:E.arr.length,rowHeight:64},L)})))});t.default=P}}]);
//# sourceMappingURL=6.56fa51c8.chunk.js.map